
<style>
    /* Style pour le lecteur de livre */
    .reader-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .book-reader {
        background: #f5f5f5;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        perspective: 2000px;
        perspective-origin: center;
    }
    
    /* Conteneur de la page avec effet 3D */
    #pdf-container {
        position: relative;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        transform-style: preserve-3d;
    }
    
    /* Canvas de la page avec effet de livre */
    #pdf-canvas {
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        display: block;
        background: white;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        transform-origin: left center;
        transform-style: preserve-3d;
        transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
    }
    
    /* Animation de feuilletage vers la droite (page suivante) */
    #pdf-canvas.page-turn-right {
        animation: pageTurnRight 0.8s cubic-bezier(0.645, 0.045, 0.355, 1) forwards;
    }
    
    /* Animation de feuilletage vers la gauche (page précédente) */
    #pdf-canvas.page-turn-left {
        animation: pageTurnLeft 0.8s cubic-bezier(0.645, 0.045, 0.355, 1) forwards;
    }
    
    @keyframes pageTurnRight {
        0% {
            transform: perspective(2000px) rotateY(0deg) translateZ(0px);
            opacity: 1;
        }
        50% {
            transform: perspective(2000px) rotateY(-90deg) translateZ(50px);
            opacity: 0.5;
        }
        51% {
            transform: perspective(2000px) rotateY(90deg) translateZ(50px);
            opacity: 0.5;
        }
        100% {
            transform: perspective(2000px) rotateY(0deg) translateZ(0px);
            opacity: 1;
        }
    }
    
    @keyframes pageTurnLeft {
        0% {
            transform: perspective(2000px) rotateY(0deg) translateZ(0px);
            opacity: 1;
        }
        50% {
            transform: perspective(2000px) rotateY(90deg) translateZ(50px);
            opacity: 0.5;
        }
        51% {
            transform: perspective(2000px) rotateY(-90deg) translateZ(50px);
            opacity: 0.5;
        }
        100% {
            transform: perspective(2000px) rotateY(0deg) translateZ(0px);
            opacity: 1;
        }
    }
    
    .reader-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    .control-btn {
        background: #0D2A4F;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .control-btn:hover {
        background: #dc2626;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }
    
    .control-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }
    
    .page-info {
        background: white;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        font-weight: bold;
        color: #0D2A4F;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .book-info {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .book-title {
        font-size: 2rem;
        font-weight: bold;
        color: #0D2A4F;
        margin-bottom: 0.5rem;
    }
    
    .book-author {
        font-size: 1.25rem;
        color: #666;
    }
    
    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #0D2A4F;
        text-decoration: none;
        font-weight: bold;
        margin-bottom: 2rem;
        padding: 0.75rem 1.5rem;
        border: 2px solid #0D2A4F;
        border-radius: 50px;
        transition: all 0.3s;
    }
    
    .back-link:hover {
        background: #0D2A4F;
        color: white;
        transform: translateX(-5px);
    }
    
    /* Animation de chargement */
    .loading {
        text-align: center;
        padding: 3rem;
        color: #0D2A4F;
    }
    
    .loading i {
        font-size: 3rem;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
</style>

<main class="reader-container">
    <a href="bibliotheque.php" class="back-link">
        <i class="fas fa-arrow-left"></i>
        Retour à la bibliothèque
    </a>
    
    <div class="book-info">
        <h1 class="book-title">ESSAI</h1>
                    <p class="book-author">Par SAINT MICHEL</p>
            </div>
    
    <div class="book-reader">
                    <div id="pdf-container">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Chargement du livre...</p>
                </div>
            </div>
            
            <div class="reader-controls">
                <button class="control-btn" id="prev-page" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Page précédente
                </button>
                
                <div class="page-info">
                    <span id="page-num">1</span> / <span id="page-count">-</span>
                </div>
                
                <button class="control-btn" id="next-page">
                    Page suivante
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <canvas id="pdf-canvas" style="display: none; width: 100%; max-width: 900px; margin: 0 auto;"></canvas>
            </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    // Configuration de PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    const pdfPath = 'uploads/book_691f7d6f87adb.pdf';
    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    const scale = 1.5;
    const canvas = document.getElementById('pdf-canvas');
    const ctx = canvas.getContext('2d');
    
    // Charger le PDF
    pdfjsLib.getDocument(pdfPath).promise.then(function(pdfDoc_) {
        pdfDoc = pdfDoc_;
        document.getElementById('page-count').textContent = pdfDoc.numPages;
        
        // Masquer le loading et afficher le canvas
        document.getElementById('pdf-container').innerHTML = '';
        document.getElementById('pdf-container').appendChild(canvas);
        canvas.style.display = 'block';
        
        // Rendre la première page
        renderPage(pageNum);
    }).catch(function(error) {
        console.error('Erreur de chargement du PDF:', error);
        document.getElementById('pdf-container').innerHTML = `
            <div style="text-align: center; padding: 3rem; color: #dc2626;">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <p style="font-size: 1.25rem; font-weight: bold;">Erreur de chargement</p>
                <p style="color: #666; margin-top: 0.5rem;">Impossible de charger le fichier PDF.</p>
            </div>
        `;
    });
    
    // Variable pour suivre la direction du feuilletage
    let turnDirection = 'right';
    
    // Fonction pour rendre une page avec effet 3D de feuilletage réaliste
    function renderPage(num, direction = 'right') {
        pageRendering = true;
        turnDirection = direction;
        
        // Appliquer la classe d'animation selon la direction
        canvas.classList.remove('page-turn-right', 'page-turn-left');
        
        // Petit délai pour réinitialiser l'animation
        setTimeout(() => {
            if (direction === 'right') {
                canvas.classList.add('page-turn-right');
            } else {
                canvas.classList.add('page-turn-left');
            }
        }, 10);
        
        // Attendre 400ms (milieu de l'animation) pour changer le contenu
        setTimeout(() => {
            pdfDoc.getPage(num).then(function(page) {
                const viewport = page.getViewport({scale: scale});
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                const renderTask = page.render(renderContext);
                
                renderTask.promise.then(function() {
                    pageRendering = false;
                    
                    // Retirer les classes d'animation après la fin
                    setTimeout(() => {
                        canvas.classList.remove('page-turn-right', 'page-turn-left');
                    }, 400);
                    
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending.num, pageNumPending.direction);
                        pageNumPending = null;
                    }
                });
            });
        }, 400);
        
        // Mettre à jour le numéro de page
        document.getElementById('page-num').textContent = num;
        
        // Gérer les boutons
        document.getElementById('prev-page').disabled = (num <= 1);
        document.getElementById('next-page').disabled = (num >= pdfDoc.numPages);
    }
    
    // Fonction pour mettre en file d'attente le rendu de page
    function queueRenderPage(num, direction) {
        if (pageRendering) {
            pageNumPending = {num: num, direction: direction};
        } else {
            renderPage(num, direction);
        }
    }
    
    // Page précédente
    document.getElementById('prev-page').addEventListener('click', function() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum, 'left');
    });
    
    // Page suivante
    document.getElementById('next-page').addEventListener('click', function() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum, 'right');
    });
    
    // Navigation au clavier
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft' && pageNum > 1) {
            pageNum--;
            queueRenderPage(pageNum, 'left');
        } else if (e.key === 'ArrowRight' && pageNum < pdfDoc.numPages) {
            pageNum++;
            queueRenderPage(pageNum, 'right');
        }
    });
</script>

